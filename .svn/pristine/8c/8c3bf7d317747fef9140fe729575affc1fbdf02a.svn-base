// pages/index/detail/detail.js
var app = getApp();
const innerAudioContext = '';
Page({
  /*页面的初始数据*/
  data: {
    title: '桃花潭里度周末',
    progress: false,
    isPlaying: false,
    imgSrc:'../../../images/audio-1.png',
    audioSrc: '',
    currentAudioTime: 0 ,
    currentAudioTimes: 0,
    audioSumTime:0,
    audioSumTimes: 0,
    progress:0,
  },
  /*生命周期函数--监听页面加载*/
  onLoad: function (options) {

  },
  onReady: function () {
    this.innerAudioContext = wx.createInnerAudioContext();
    this.innerAudioContext.src = 'http://ws.stream.qqmusic.qq.com/M500001VfvsJ21xFqb.mp3?guid=ffffffff82def4af4b12b3cd9337d5e7&uin=346897220&vkey=6292F51E1E384E061FF02C31F716658E5C81F5594D561F2E88B854E81CAAB7806D5E4F103E55D33C16F3FAC506D1AB172DE8600B37E43FAD&fromtag=46' ;
    this.setData({
      audioSrc: this.innerAudioContext.src
      
    })
  },


  // playAndPause: function () {
  //   var that = this
  //   if (that.data.isPlaying) {
  //     wx.pauseBackgroundAudio()
  //   }
  //   else {
  //     wx.playBackgroundAudio()
  //   }

  //   that.setData({
  //     isPlaying: !that.data.isPlaying
  //   })
  // },
  onMusicTap: function (event) {

    var timer = 0 ;
    // 1.判断播放状态 true为暂停 false为播放
    console.log("播放状态" + this.innerAudioContext.paused)
    if (this.innerAudioContext.paused){
      // this.innerAudioContext.autoplay = true;
      if(timer == 0 ){
        this.innerAudioContext.play();
      }else{
        this.innerAudioContext.seek(timer);
      }
      
    }else{
      // this.innerAudioContext.stop();
      this.innerAudioContext.pause();
    }
    this.innerAudioContext.onPlay(() => {
      console.log("正在播放")
      this.setData({
        imgSrc: '../../../images/audio-2.png'
      })
    })
    this.innerAudioContext.onPause(() => {
      console.log("暂停")
      this.setData({
        imgSrc: '../../../images/audio-1.png'
      })
    })
    this.innerAudioContext.onTimeUpdate(() => {
      console.log("当前音频的播放位置" + this.innerAudioContext.currentTime);
      timer = this.innerAudioContext.currentTime ;
      this.setData({        
        currentAudioTime: parseInt(this.innerAudioContext.currentTime / 60),
        currentAudioTimes: parseInt(this.innerAudioContext.currentTime % 60),
        audioSumTime: parseInt((this.innerAudioContext.duration) / 60),
        audioSumTimes: parseInt((this.innerAudioContext.duration) % 60),
        progress: parseInt((this.innerAudioContext.currentTime / this.innerAudioContext.duration) * 100)
      })
      
    })
  }

   



  // onMusicTap: function (event) {
  //   //const backgroundAudioManager = wx.getBackgroundAudioManager()
  //   // const innerAudioContext = wx.createInnerAudioContext();
  //   //innerAudioContext.autoplay = true;
  //   this.innerAudioContext.src = 'http://ws.stream.qqmusic.qq.com/M500001VfvsJ21xFqb.mp3?guid=ffffffff82def4af4b12b3cd9337d5e7&uin=346897220&vkey=6292F51E1E384E061FF02C31F716658E5C81F5594D561F2E88B854E81CAAB7806D5E4F103E55D33C16F3FAC506D1AB172DE8600B37E43FAD&fromtag=46';

  //   //播放状态isPlayingMusic
  //   var isPlayingMusic = this.data.isPlayingMusic;
  //   console.log("播放状态" + isPlayingMusic)
  //   // this.innerAudioContext.play();
  //   // this.innerAudioContext.pause();

  //   if (isPlayingMusic) {
  //     this.innerAudioContext.pause();
  //     // this.innerAudioContext.stop();
  //     this.setData({
  //       isPlayingMusic: false

  //     })

  //   }
  //   else {
  //     this.innerAudioContext.play();
  //     this.setData({
  //       isPlayingMusic: true

  //     })
  //   }
  //   // this.innerAudioContext.onPlay(() => {
  //   //   console.log('开始播放')
  //   //   // this.innerAudioContext.pause();
  //   //   //startTime	Number	开始播放的位置（单位：s），默认 0
  //   //   // console.log("开始播放的位置" + this.innerAudioContext.startTime)
  //   //   //duration	Number	当前音频的长度（单位：s），只有在当前有合法的 src 时返回
  //   //   // console.log("当前音频的长度" + this.innerAudioContext.duration)
  //   //   //currentTime	Number	当前音频的播放位置（单位：s），只有在当前有合法的 src 时返回，时间不取整，保留小数点后 6 位
  //   //   // console.log("当前音频的播放位置" + this.innerAudioContext.currentTime)
  //   // })
  //   // this.innerAudioContext.onPause(() => {
  //   //   console.log('暂停播放')

  //   // })
  //   // this.innerAudioContext.onStop(() => {
  //   //   console.log('停止')

  //   // })
  //   this.innerAudioContext.onTimeUpdate(() => {
  //     //console.log('进度')
  //     //console.log("当前音频的播放位置" + this.innerAudioContext.currentTime)
  //   })

  //   //app.globalData.g_currentMusicPostId = this.data.currentPostId;
  //   //app.globalData.g_isPlayingMusic = true;
  // },
})